<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/obj.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">src/</a> obj.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.39% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>61/62</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>10/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">94.74% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>18/19</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.36% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>60/61</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">26×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">36×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">"use strict";
var shortid = require('shortid');
var _ = require('lodash');
var Joi = require('joi');
var errors_1 = require('./errors');
var threadtime_common_1 = require('@threadtime/threadtime-common');
// Generic object class
var Obj = (function () {
    /**
     * Represents an Obj in Threadtime, server-side.
     * @param app Threadtime Server App instance
     * @param id Threadtime Obj ID
     */
    function Obj(app, id) {
        this.app = app;
        if (typeof id === 'string') {
            this._id = id;
        }
        else {
            this._id = "" + threadtime_common_1.ObjType.Generic + shortid.generate();
        }
        this.owner_id = null;
        this.parent_ids = [];
        this.time = Math.floor(Date.now() / 1000);
        this.collection = this.app.collectionFor(this.type);
    }
    Object.defineProperty(Obj.prototype, "type", {
        get: function () {
            return parseInt(this._id[0]);
        },
        set: function (objType) {
            this._id = "" + objType + this._id.slice(1);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Obj.prototype, "owner", {
        get: function () {
            return new Obj(this.app, this.owner_id);
        },
        set: function (obj) {
            this.owner_id = obj._id;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Obj.prototype, "parents", {
        get: function () {
            var _this = this;
            return this.parent_ids.map(function (id) {
                return new Obj(_this.app, id);
            });
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Add a parent given an Obj
     * @param parent Parent to add to the parents list
     */
    Obj.prototype.addParent = function (parent) {
        this.parent_ids.push(parent._id);
    };
    /**
     * Remove a parent given an Obj
     * @param parent Parent to remove from the parents list
     */
    Obj.prototype.rmParent = function (parent) {
        _.pull(this.parent_ids, parent._id);
    };
    /** Load the document from the relevant collection in the database
     *
     * @returns {Promise&lt;void&gt;|Promise} Promise resolved when document loaded, rejected on failure
     */
    Obj.prototype.load = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this.collection.find({ _id: _this._id }).limit(1).toArray().then(function (docs) {
                if (_.isEmpty(docs))
                    return reject(new errors_1.ObjNotFoundError());
                var doc = docs[0];
                _.forEach(doc, function (val, key) {
                    if (key.charAt(0) === '_')
                        return; // Skip properties that begin with an underscore
                    _this[key] = val;
                });
                resolve();
            }).catch(<span class="fstat-no" title="function not covered" >function (err) {</span> <span class="cstat-no" title="statement not covered" >return reject(err); </span>});
        });
    };
    Obj.prototype.validate = function () {
        var schema = threadtime_common_1.ObjSchemaMap[this.type];
        var result = Joi.validate(this, schema.joi, { allowUnknown: true });
        if (result.error === null) {
            return { success: true, error: null };
        }
        else {
            return { success: false, error: result.error };
        }
    };
    Obj.prototype.save = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            // Validate first
            var validation = _this.validate();
            if (!validation.success)
                return reject(new errors_1.ValidationError()); // TODO return with validation data
            var doc = {};
            for (var _i = 0, _a = threadtime_common_1.ObjSchemaMap[_this.type].keys; _i &lt; _a.length; _i++) {
                var k = _a[_i];
                doc[k] = _this[k];
            }
            return _this.collection.updateOne({ _id: _this._id }, doc, { upsert: true }).then(function () { return resolve(); });
        });
    };
    return Obj;
}());
exports.Obj = Obj;
&nbsp;
//# sourceMappingURL=data:application/json;charset=utf8;base64,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LEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFBO1FBQ2xELENBQUM7SUFDTCxDQUFDO0lBRUQsa0JBQUksR0FBSjtRQUFBLGlCQVdDO1FBVkcsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFPLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFDckMsaUJBQWlCO1lBQ2pCLElBQUksVUFBVSxHQUFHLEtBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNqQyxFQUFFLENBQUEsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUM7Z0JBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLHdCQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUMsbUNBQW1DO1lBRWpHLElBQUksR0FBRyxHQUF1QixFQUFFLENBQUM7WUFDakMsR0FBRyxDQUFBLENBQVUsVUFBNEIsRUFBNUIsS0FBQSxnQ0FBWSxDQUFDLEtBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQTVCLGNBQTRCLEVBQTVCLElBQTRCLENBQUM7Z0JBQXRDLElBQUksQ0FBQyxTQUFBO2dCQUFrQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQVMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQUE7WUFFbkUsTUFBTSxDQUFDLEtBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUMsR0FBRyxFQUFFLEtBQUksQ0FBQyxHQUFHLEVBQUMsRUFBRSxHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBTSxPQUFBLE9BQU8sRUFBRSxFQUFULENBQVMsQ0FBQyxDQUFDO1FBQ2pHLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNMLFVBQUM7QUFBRCxDQTlHQSxBQThHQyxJQUFBO0FBOUdZLFdBQUcsTUE4R2YsQ0FBQSIsImZpbGUiOiJzcmMvb2JqLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW1wb3J0IHsgUHJvbWlzZSB9IGZyb20gJ2VzNi1wcm9taXNlJztcbmltcG9ydCAqIGFzIG1vbmdvZGIgZnJvbSAnbW9uZ29kYic7XG5pbXBvcnQgKiBhcyBzaG9ydGlkIGZyb20gJ3Nob3J0aWQnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0ICogYXMgSm9pIGZyb20gJ2pvaSc7XG5cbmltcG9ydCB7IEFwcCB9IGZyb20gJy4vYXBwJztcbmltcG9ydCB7IENvbGxlY3Rpb25NYXAgfSBmcm9tICcuL2NvbGxlY3Rpb25fbWFwJztcbmltcG9ydCB7IE9iak5vdEZvdW5kRXJyb3IsIFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4vZXJyb3JzJztcbmltcG9ydCB7IElPYmosIE9ialR5cGUsIE9ialNjaGVtYU1hcCB9IGZyb20gJ0B0aHJlYWR0aW1lL3RocmVhZHRpbWUtY29tbW9uJztcblxuLy8gR2VuZXJpYyBvYmplY3QgY2xhc3NcbmV4cG9ydCBjbGFzcyBPYmogaW1wbGVtZW50cyBJT2JqIHtcbiAgICBwcml2YXRlIGFwcDogQXBwO1xuXG4gICAgcHVibGljIF9pZDogc3RyaW5nO1xuICAgIHB1YmxpYyBvd25lcl9pZDogc3RyaW5nO1xuICAgIHB1YmxpYyBwYXJlbnRfaWRzOiBzdHJpbmdbXTtcbiAgICBwdWJsaWMgdGltZTogbnVtYmVyO1xuXG4gICAgcHJpdmF0ZSBjb2xsZWN0aW9uOiBtb25nb2RiLkNvbGxlY3Rpb247XG5cbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGFuIE9iaiBpbiBUaHJlYWR0aW1lLCBzZXJ2ZXItc2lkZS5cbiAgICAgKiBAcGFyYW0gYXBwIFRocmVhZHRpbWUgU2VydmVyIEFwcCBpbnN0YW5jZVxuICAgICAqIEBwYXJhbSBpZCBUaHJlYWR0aW1lIE9iaiBJRFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBpZD86IHN0cmluZykge1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcblxuICAgICAgICBpZih0eXBlb2YgaWQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0aGlzLl9pZCA9IGlkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5faWQgPSBgJHtPYmpUeXBlLkdlbmVyaWN9JHtzaG9ydGlkLmdlbmVyYXRlKCl9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub3duZXJfaWQgPSBudWxsO1xuICAgICAgICB0aGlzLnBhcmVudF9pZHMgPSBbXTtcbiAgICAgICAgdGhpcy50aW1lID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7XG5cbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gdGhpcy5hcHAuY29sbGVjdGlvbkZvcih0aGlzLnR5cGUpO1xuICAgIH1cblxuICAgIGdldCB0eXBlKCk6IE9ialR5cGUge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5faWRbMF0pO1xuICAgIH1cblxuICAgIHNldCB0eXBlKG9ialR5cGU6IE9ialR5cGUpIHtcbiAgICAgICAgdGhpcy5faWQgPSBgJHtvYmpUeXBlfSR7dGhpcy5faWQuc2xpY2UoMSl9YDtcbiAgICB9XG5cbiAgICBnZXQgb3duZXIoKTogT2JqIHtcbiAgICAgICAgcmV0dXJuIG5ldyBPYmoodGhpcy5hcHAsIHRoaXMub3duZXJfaWQpO1xuICAgIH1cblxuICAgIHNldCBvd25lcihvYmo6IE9iaikge1xuICAgICAgICB0aGlzLm93bmVyX2lkID0gb2JqLl9pZDtcbiAgICB9XG5cbiAgICBnZXQgcGFyZW50cygpOiBPYmpbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudF9pZHMubWFwKChpZDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE9iaih0aGlzLmFwcCwgaWQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSBwYXJlbnQgZ2l2ZW4gYW4gT2JqXG4gICAgICogQHBhcmFtIHBhcmVudCBQYXJlbnQgdG8gYWRkIHRvIHRoZSBwYXJlbnRzIGxpc3RcbiAgICAgKi9cbiAgICBhZGRQYXJlbnQocGFyZW50OiBPYmopOiB2b2lkIHtcbiAgICAgICAgdGhpcy5wYXJlbnRfaWRzLnB1c2gocGFyZW50Ll9pZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgcGFyZW50IGdpdmVuIGFuIE9ialxuICAgICAqIEBwYXJhbSBwYXJlbnQgUGFyZW50IHRvIHJlbW92ZSBmcm9tIHRoZSBwYXJlbnRzIGxpc3RcbiAgICAgKi9cbiAgICBybVBhcmVudChwYXJlbnQ6IE9iaik6IHZvaWQge1xuICAgICAgICBfLnB1bGwodGhpcy5wYXJlbnRfaWRzLCBwYXJlbnQuX2lkKTtcbiAgICB9XG5cbiAgICAvKiogTG9hZCB0aGUgZG9jdW1lbnQgZnJvbSB0aGUgcmVsZXZhbnQgY29sbGVjdGlvbiBpbiB0aGUgZGF0YWJhc2VcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fFByb21pc2V9IFByb21pc2UgcmVzb2x2ZWQgd2hlbiBkb2N1bWVudCBsb2FkZWQsIHJlamVjdGVkIG9uIGZhaWx1cmVcbiAgICAgKi9cbiAgICBsb2FkKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmZpbmQoe19pZDogdGhpcy5faWR9KS5saW1pdCgxKS50b0FycmF5KCkudGhlbigoZG9jczogT2JqZWN0W10pID0+IHtcbiAgICAgICAgICAgICAgICBpZihfLmlzRW1wdHkoZG9jcykpIHJldHVybiByZWplY3QobmV3IE9iak5vdEZvdW5kRXJyb3IoKSk7XG4gICAgICAgICAgICAgICAgbGV0IGRvYyA9IGRvY3NbMF07XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRvYywgKHZhbDogYW55LCBrZXk6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZihrZXkuY2hhckF0KDApID09PSAnXycpIHJldHVybjsgLy8gU2tpcCBwcm9wZXJ0aWVzIHRoYXQgYmVnaW4gd2l0aCBhbiB1bmRlcnNjb3JlXG4gICAgICAgICAgICAgICAgICAgICg8YW55PnRoaXMpW2tleV0gPSB2YWw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4gcmVqZWN0KGVycikpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB2YWxpZGF0ZSgpOiBJT2JqVmFsaWRhdGlvbiB7XG4gICAgICAgIGxldCBzY2hlbWEgPSBPYmpTY2hlbWFNYXBbdGhpcy50eXBlXTtcbiAgICAgICAgbGV0IHJlc3VsdCA9IEpvaS52YWxpZGF0ZSh0aGlzLCBzY2hlbWEuam9pLCB7IGFsbG93VW5rbm93bjogdHJ1ZSB9KTtcblxuICAgICAgICBpZihyZXN1bHQuZXJyb3IgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGVycm9yOiBudWxsIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogcmVzdWx0LmVycm9yIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNhdmUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAvLyBWYWxpZGF0ZSBmaXJzdFxuICAgICAgICAgICAgbGV0IHZhbGlkYXRpb24gPSB0aGlzLnZhbGlkYXRlKCk7XG4gICAgICAgICAgICBpZighdmFsaWRhdGlvbi5zdWNjZXNzKSByZXR1cm4gcmVqZWN0KG5ldyBWYWxpZGF0aW9uRXJyb3IoKSk7IC8vIFRPRE8gcmV0dXJuIHdpdGggdmFsaWRhdGlvbiBkYXRhXG5cbiAgICAgICAgICAgIGxldCBkb2M6IHtbeDogc3RyaW5nXTogYW55fSA9IHt9O1xuICAgICAgICAgICAgZm9yKGxldCBrIG9mIE9ialNjaGVtYU1hcFt0aGlzLnR5cGVdLmtleXMpIGRvY1trXSA9ICg8YW55PnRoaXMpW2tdO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uLnVwZGF0ZU9uZSh7X2lkOiB0aGlzLl9pZH0sIGRvYywge3Vwc2VydDogdHJ1ZX0pLnRoZW4oKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElPYmpWYWxpZGF0aW9uIHtcbiAgICBzdWNjZXNzOiBib29sZWFuLFxuICAgIGVycm9yOiBKb2kuVmFsaWRhdGlvbkVycm9yXG59Il19
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Oct 31 2016 16:55:37 GMT+1100 (AEDT)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
